!function(){var t={};t.Colormap={static:"#303045",elements:"#222222",0:"#1078f1",1:"#d12110",2:"#10b121",3:"#107131",4:"#f1b120",5:"#1020f1",6:"#f18120",7:"#6710f1",rope:"#888",length:8},window.Regulus=t}(),function(){function t(t,e){var i=0,o=0;if("number"==typeof t||"object"==typeof t)if("number"==typeof t&&"number"==typeof e)i=t,o=e;else if("number"==typeof t&&"number"!=typeof e)i=t,o=t;else if("number"==typeof t[0]){i=t[0];var s=t[1];o="number"==typeof s?s:i}else"number"==typeof t.x&&(i=t.x,o="number"==typeof t.y?t.y:t.x);return{x:i,y:o}}Regulus.Vector=function(e,i){var o=t(e,i);this.x=o.x,this.y=o.y},Regulus.Vector.prototype.add=function(e,i){var o=t(e,i),s=this.x+o.x,n=this.y+o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.sub=function(e,i){var o=t(e,i),s=this.x-o.x,n=this.y-o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.mul=function(e,i){var o=t(e,i),s=this.x*o.x,n=this.y*o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.div=function(e,i){var o=t(e,i),s=this.x/o.x,n=this.y/o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.addsub=function(e,i){var o=t(e,i),s=this.x+o.x,n=this.y-o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.subadd=function(e,i){var o=t(e,i),s=this.x-o.x,n=this.y+o.y;return new Regulus.Vector(s,n)},Regulus.Vector.prototype.mag=this.len=function(){return Math.sqrt(this.magsq())},Regulus.Vector.prototype.magsq=this.lensq=function(){return this.x*this.x+this.y*this.y},Regulus.Vector.prototype.dir=function(){return this.x>0&&0===this.y?Math.PI/2:this.x<0&&0===this.y?Math.PI/2+Math.PI:0===this.x&&0===this.y?0:0===this.x&&this.y>0?0:0===this.x&&this.y<0?Math.PI:this.x>0?Math.atan2(this.x,this.y):Math.atan2(this.x,this.y)+2*Math.PI},Regulus.Vector.prototype.dist=function(t,e){return Math.sqrt(this.distsq(t,e))},Regulus.Vector.prototype.distsq=function(e,i){var o=t(e,i),s=this.x-o.x,n=this.y-o.y;return s*s+n*n},Regulus.Vector.prototype.dot=function(e,i){var o=t(e,i);return this.x*o.x+this.y*o.y},Regulus.Vector.prototype.cross=function(e,i){var o=t(e,i);return this.x*o.y-this.y*o.x},Regulus.Vector.prototype.neg=function(){var t=-this.x,e=-this.y;return new Regulus.Vector(t,e)},Regulus.Vector.prototype.perp=function(){return 0===this.mag()?new Regulus.Vector(0,-1):new Regulus.Vector(this.y,-this.x)},Regulus.Vector.prototype.norm=function(){var t=this.mag();return 0===t?new Regulus.Vector(1,0):this.div(t)},Regulus.Vector.prototype.negperp=function(){return 0===this.mag()?new Regulus.Vector(0,1):new Regulus.Vector(-this.y,this.x)},Regulus.Vector.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return new Regulus.Vector(this.x*e-this.y*i,this.x*i+this.y*e)},Regulus.Vector.prototype.rotateSinCos=function(t,e){return new Regulus.Vector(this.x*e-this.y*t,this.x*t+this.y*e)},Regulus.Vector.prototype.set=function(e,i){var o=t(e,i);return this.x=o.x,this.y=o.y,this},Regulus.Vector.prototype.setpolar=function(t,e){var i=Math.sin(e)*t,o=Math.cos(e)*t;return this.x=i,this.y=o,this},Regulus.Vector.prototype.project=function(t,e){var i=new Regulus.Vector(t,e);return i.norm().mul(this.dot(i.norm()))},Regulus.Vector.prototype.rawProject=function(t,e){var i=new Regulus.Vector(t,e);return this.dot(i.norm())},Regulus.Vector.prototype.clone=function(){return new Regulus.Vector(this.x,this.y)},Regulus.Vector.prototype.parallelTo=function(t,e){return Math.abs(this.cross(t,e))<1e-7},Regulus.Vector.prototype.Add=function(e,i){var o=t(e,i);return this.set(this.x+o.x,this.y+o.y)},Regulus.Vector.prototype.Sub=function(e,i){var o=t(e,i);return this.set(this.x-o.x,this.y-o.y)},Regulus.Vector.prototype.Mul=function(e,i){var o=t(e,i);return this.set(this.x*o.x,this.y*o.y)},Regulus.Vector.prototype.Div=function(e,i){var o=t(e,i);return this.set(this.x/o.x,this.y/o.y)},Regulus.Vector.prototype.Addsub=function(e,i){var o=t(e,i);return this.set(this.x+o.x,this.y-o.y)},Regulus.Vector.prototype.Subadd=function(e,i){var o=t(e,i);return this.set(this.x-o.x,this.y+o.y)},Regulus.Vector.prototype.Neg=function(){return this.set(-this.x,-this.y)},Regulus.Vector.prototype.Perp=function(){return 0===this.mag()?this.set(0,-1):this.set(this.y,-this.x)},Regulus.Vector.prototype.Norm=function(){var t=this.mag();return 0===t?this.set(1,0):this.set(this.x/t,this.y/t)},Regulus.Vector.prototype.Negperp=function(){return 0===this.mag()?this.set(0,1):this.set(-this.y,this.x)},Regulus.Vector.prototype.Rotate=function(t){var e=Math.cos(t),i=Math.sin(t),o=this.x*e-this.y*i,s=this.x*i+this.y*e;return this.x=o,this.y=s,this},Regulus.Vector.prototype.RotateSinCos=function(t,e){var i=this.x*e-this.y*t,o=this.x*t+this.y*e;return this.x=i,this.y=o,this},Regulus.Vector.prototype.Project=function(t,e){return this.set(this.project(t,e))},Regulus.Vector.average=function(t){var e=0,i=0;if(1===t.length)return t[0];for(var o=0;o<t.length;o++)e+=t[o].x,i+=t[o].y;return new Regulus.Vector(e/t.length,i/t.length)},Regulus.Vector.fromPolar=function(t,e){return(new Regulus.Vector).setpolar(t,e)},Regulus.Vector.fromDirection=function(t){return(new Regulus.Vector).setpolar(1,t)}}(),function(){Regulus.Box=function(t,e){this.pos=new Regulus.Vector(t),this.size=new Regulus.Vector(e)},Regulus.Box.prototype.getMin=function(){return this.pos.sub(this.size.x/2,this.size.y/2)},Regulus.Box.prototype.getMax=function(){return this.pos.add(this.size.x/2,this.size.y/2)},Regulus.Box.prototype.setMin=function(t){var e=this.getMax().sub(t),i=t.add(e.div(2));this.pos=i,this.size=e},Regulus.Box.prototype.setMax=function(t){var e=this.getMin(),i=t.sub(e),o=e.add(i.div(2));this.pos=o,this.size=i},Regulus.Box.prototype.area=function(){return this.size.x*this.size.y},Regulus.Box.prototype.circumference=function(){return 2*this.size.x+2*this.size.y},Regulus.Box.prototype.inside=function(t){var e=this.getMin(),i=this.getMax();return t.x>=e.x&&t.x<=i.x&&t.y>=e.y&&t.y<=i.y},Regulus.Box.prototype.overlap=function(t){var e=this.getMin(),i=this.getMax(),o=t.getMin(),s=t.getMax();return e.x<=s.x&&i.x>=o.x&&e.y<=s.y&&i.y>=o.y},Regulus.Box.fromMinMax=function(t,e){t=new Regulus.Vector(t),e=new Regulus.Vector(e);var i=t.add(e).Div(2),o=e.sub(t);return new Regulus.Box(i,o)}}(),function(){Regulus.DistanceToLine=function(t,e,i){var o=i.sub(e),s=t.sub(e),n=s.dot(o.norm())/o.mag();if(n>0&&n<1){var r=o.mul(n);return s.sub(r).mag()}return n<=0?t.dist(e):t.dist(i)},Regulus.DistToLineInfo=function(t,e,i){var o=i.sub(e),s=t.sub(e),n=s.dot(o.norm())/o.mag();if(n>0&&n<1){var r=o.mul(n),a=s.sub(r);return{distance:a.mag(),onEdge:!0,p1:!1,p2:!1,normal:a.norm().neg(),closest:e.add(r)}}return n<=0?{distance:t.dist(e),onEdge:!1,p1:!0,p2:!1,normal:e.sub(t).norm(),closest:e}:{distance:t.dist(i),onEdge:!1,p1:!1,p2:!0,normal:i.sub(t).norm(),closest:i}}}(),function(){Regulus.IntersectionPoint=function(t,e,i,o){var s,n,r=t.x,a=e.x,u=i.x,l=o.x,h=t.y,p=e.y,c=i.y,g=o.y,d=(g-c)*(a-r)-(l-u)*(p-h);return s=((l-u)*(h-c)-(g-c)*(r-u))/d,n=((a-r)*(h-c)-(p-h)*(r-u))/d,{pt:new Regulus.Vector(r+s*(a-r),h+s*(p-h)),seg1:s>=-1e-4&&s<=1.0001,seg2:n>=-1e-4&&n<=1.0001,between1:s-1e-4>0&&s+1e-4<1,between2:n-1e-4>0&&n+1e-4<1,u1:s,u2:n}}}(),function(){Regulus.Math={clamp:function(t,e,i){return t<e?e:t>i?i:t},inRange:function(t,e,i){return t>e&&t<i},onRange:function(t,e,i){return t>=e&&t<=i},vecScalar:function(t,e){var i=new Regulus.Vector(t);return new Regulus.Vector(e*i.y,-e*i.x)},scalarVec:function(t,e){var i=new Regulus.Vector(e);return new Regulus.Vector(-t*i.y,t*i.x)},pythagoreanSolve:function(t,e){return Math.sqrt(t*t+e*e)}}}(),function(){Regulus.Vertices={},Regulus.Vertices.fromBox=function(t,e){var i=t/2,o=e/2;return[[-i,-o],[-i,o],[i,o],[i,-o]]},Regulus.Vertices.fromSquare=function(t){var e=t/2,i=t/2;return[[-e,-i],[-e,i],[e,i],[e,-i]]},Regulus.Vertices.fromRegularPolygon=function(t,e){for(var i=[],o=Math.PI/(e/2),s=0;s<e;s++)i.push([Math.sin(o*s)*t,Math.cos(o*s)*t]);return i}}(),function(){Regulus.Circle=function(t,e,i){this.radius=t,this.rotation=e||0,this.position=new Regulus.Vector(i)},Regulus.Circle.prototype.center=function(){return this.position},Regulus.Circle.prototype.alignCenter=function(){this.position.set(0,0)},Regulus.Circle.prototype.area=function(){return this.radius*this.radius*Math.PI},Regulus.Circle.prototype.circumference=function(){return 2*this.radius*Math.PI},Regulus.Circle.prototype.getBox=function(){return new Regulus.Box(this.position,2*this.radius)},Regulus.Circle.prototype.clone=function(){return new Regulus.Circle(this.radius,this.rotation,this.position)},Regulus.Circle.prototype.mass=function(t){return this.area()*t},Regulus.Circle.prototype.inertia=function(t){return this.mass(t)*this.radius*this.radius},Regulus.Circle.prototype.pointInside=function(t){return this.position.dist(t)<=this.radius},Regulus.Circle.prototype.type="Circle"}(),function(){function t(t){var e=0;return t.forEach(function(t){e+=this.x*t.y,e-=this.y*t.x}),e/2}Regulus.Polygon=function(t,e,i){this.vertices=[],this.rotation=e||0,this.position=new Regulus.Vector(i);var o,s=t.length;for(o=0;o<s;o++)this.vertices.push(new Regulus.Vector(t[o]))},Regulus.Polygon.prototype.area=function(){return Math.abs(t(this))},Regulus.Polygon.prototype.isCounterClockwise=this.isAntiClockwise=function(){return t(this)<0},Regulus.Polygon.prototype.isClockwise=function(){return t(this)>0},Regulus.Polygon.prototype.isLineOrPoint=function(){return 0===t(this)},Regulus.Polygon.prototype.getComplexAngles=function(){var t=[],e=this.isClockwise();return this.forEach(function(i,o,s){var n=i.sub(this),r=this.sub(o),a=(Math.atan2(n.x,n.y)-Math.atan2(r.x,r.y)+2*Math.PI)%(2*Math.PI)-Math.PI;a<=0&&e&&t.push({vertex:this,index:s}),a>=0&&!e&&t.push({vertex:this,index:s})}),t},Regulus.Polygon.prototype.isConvex=function(){return this.vertices.length<4||this.getComplexAngles().length<1},Regulus.Polygon.prototype.isConcave=function(){return!(this.vertices.length<4)&&this.getComplexAngles().length>0},Regulus.Polygon.prototype.getSelfIntersections=function(){var t=this,e=[];return t.forEach(function(i,o,s,n){var r=this;t.forEach(function(t,o,a,u){if(!(a<=s)&&n!==a&&u!==s){var l=Regulus.IntersectionPoint(r,i,this,t);l.seg1&&l.seg2&&e.push({index1:s,index2:a,point:l.pt,iscObject:l})}})}),e},Regulus.Polygon.prototype.isSimple=function(){return this.vertices.length<4||this.getSelfIntersections().length<1},Regulus.Polygon.prototype.isComplex=this.isSelfIntersecting=function(){return!(this.vertices.length<4)&&this.getSelfIntersections().length>0},Regulus.Polygon.prototype.isSATCompatible=function(){return this.isSimple()&&this.isConvex()},Regulus.Polygon.prototype.isSATIncompatible=function(){return this.isComplex()||this.isConcave()},Regulus.Polygon.prototype.removeDoubles=function(){var t=[];this.forEach(function(e){this.dist(e)>1e-4&&t.push(this)}),this.vertices=t},Regulus.Polygon.prototype.clone=function(){var t=new Regulus.Polygon([]);return this.forEach(function(){t.pushVertex(this.clone())}),t.rotation=this.rotation+0,t.position=this.position.clone(),t},Regulus.Polygon.prototype.pointInside=function(t){var e=t.add(new Regulus.Vector(1,0)),i=!1,o=this.clone();return o.globalizeToRotation(this.rotation),o.globalizeToPoint(this.position),o.forEach(function(o){var s=Regulus.IntersectionPoint(t,e,this,o);s.u1>=0&&s.seg2&&(i=!i)}),i},Regulus.Polygon.prototype.getBox=function(){for(var t=1/0,e=-1/0,i=1/0,o=-1/0,s=0;s<this.vertices.length;s++){var n=this.vertices[s].x,r=this.vertices[s].y;n>e&&(e=n),n<t&&(t=n),r>o&&(o=r),r<i&&(i=r)}return Regulus.Box.fromMinMax([t,i],[e,o])},Regulus.Polygon.prototype.getSATAxes=function(t,e){t=t||[];var i=this;return this.isClockwise()&&i.reverse(),i.forEach(function(i){var o,s=i.sub(this).perp().norm(),n=!0,r=t.length;for(o=0;o<r;o++)s.parallelTo(t[o])&&(n=!1);n&&t.push(e?s:s.neg())}),t},Regulus.Polygon.prototype.getBestEdge=function(t){var e,i,o,s,n=-1/0;this.forEach(function(r,a,u){var l=t.dot(this);l>n&&(n=l,e=this,i=r,o=a,s=u)});var r=e.sub(i).Norm();return e.sub(o).Norm().dot(t)<=r.dot(t)?{index:s,vertex:e,edge:o.sub(e),vtx1:o,vtx2:e}:{index:s,vertex:e,edge:e.sub(i),vtx1:e,vtx2:i}},Regulus.Polygon.prototype.getEdge=function(t){var e=t+1;return e=e>=this.vertices.length?0:e,this.vertices[e].sub(this.vertices[t])},Regulus.Polygon.prototype.globalizeToPoint=function(t){for(var e=this.vertices.length,i=0;i<e;i++)this.vertices[i].Add(t)},Regulus.Polygon.prototype.deglobalizeFromPoint=function(t){for(var e=this.vertices.length,i=0;i<e;i++)this.vertices[i].Sub(t)},Regulus.Polygon.prototype.removeVertex=function(t){return this.vertices.splice(t,1)},Regulus.Polygon.prototype.addVertex=function(t,e,i){return this.vertices.splice(t,0,new Regulus.Vector(e,i))},Regulus.Polygon.prototype.pushVertex=function(t,e){return this.vertices.push(new Regulus.Vector(t,e))},Regulus.Polygon.prototype.globalizeToRotation=function(t){for(var e=this.vertices.length,i=Math.sin(t),o=Math.cos(t),s=0;s<e;s++)this.vertices[s].RotateSinCos(i,o)},Regulus.Polygon.prototype.globalized=function(t,e){for(var i=this.vertices.length,o=new Regulus.Polygon([]),s=Math.sin(t),n=Math.cos(t),r=0;r<i;r++)o.pushVertex(this.vertices[r].rotateSinCos(s,n).Add(e));return o},Regulus.Polygon.prototype.forEach=function(t,e){var i=this.vertices.length;e=e||0;for(var o=0;o<i+e;o++){var s=o+1;s=s>=i?0:s;var n=o-1;n=n<0?i-1:n,t.call(this.vertices[o],this.vertices[s],this.vertices[n],o,s,n,function(t){o+=t=t||1})}},Regulus.Polygon.prototype.deglobalizeFromRotation=function(t){for(var e=this.vertices.length,i=Math.sin(-t),o=Math.cos(-t),s=0;s<e;s++)this.vertices[s].RotateSinCos(i,o)},Regulus.Polygon.prototype.deglobalize=function(t,e){for(var i=this.vertices.length,o=Math.sin(-t),s=Math.cos(-t),n=0;n<i;n++)this.vertices[n].RotateSinCos(o,s).Sub(e)},Regulus.Polygon.prototype.reverse=function(){for(var t=[],e=this.vertices.length,i=0;i<e;i++)t.unshift(this.vertices[i]);this.vertices=t},Regulus.Polygon.prototype.chamfer=function(t,e,i,o){(t=t||[8]).length||(t=[t]),e=void 0!==e?e:-1,i=i||2,o=o||14;var s=[];this.isClockwise()&&this.reverse();for(var n=this.vertices.length,r=0;r<n;r++){var a=this.vertices[r-1>=0?r-1:n-1],u=this.vertices[r],l=this.vertices[(r+1)%n],h=t[r<t.length?r:t.length-1];if(0!==h){var p=new Regulus.Vector(u.y-a.y,a.x-u.x).norm().neg(),c=new Regulus.Vector(l.y-u.y,u.x-l.x).norm().neg(),g=Math.sqrt(2*Math.pow(h,2)),d=p.mul(h),y=p.add(c).mul(.5).norm(),f=u.sub(y.mul(g)),v=e;-1===e&&(v=1.75*Math.pow(h,.32)),(v=Regulus.Math.clamp(v,i,o))%2==1&&(v+=1);for(var b=Math.acos(p.dot(c))/v,m=0;m<v;m++)s.push(d.rotate(-b*m).add(f))}else s.push(u)}this.vertices=s},Regulus.Polygon.prototype.mass=function(t){return this.area()*t},Regulus.Polygon.prototype.inertia=function(t){var e=0,i=0;return this.forEach(function(t){var o=this.x*t.y-this.y*t.x;i+=(this.x*this.x+this.x*t.x+t.x*t.x)*o,e+=(this.y*this.y+this.y*t.y+t.y*t.y)*o}),e*=t/12,i*=t/12,Math.abs(e+i)},Regulus.Polygon.prototype.type="Polygon"}(),function(){Regulus.InfiniteBar=function(t,e,i){this.width=t,this.rotation=e||0,this.position=new Regulus.Vector(i)},Regulus.InfiniteBar.prototype.area=function(){return 1/0},Regulus.InfiniteBar.prototype.circumference=function(){return 1/0},Regulus.InfiniteBar.prototype.pointInside=function(t){var e=Regulus.Vector.fromDirection(this.rotation),i=t.sub(this.position).rawProject(e);return Math.abs(i)<=this.width/2},Regulus.InfiniteBar.prototype.pointInPosSide=function(t){var e=Regulus.Vector.fromDirection(this.rotation),i=t.sub(this.position).rawProject(e);return Regulus.Math.onRange(i,0,this.width/2)},Regulus.InfiniteBar.prototype.pointInNegSide=function(t){var e=Regulus.Vector.fromDirection(this.rotation),i=t.sub(this.position).rawProject(e);return Regulus.Math.inRange(i,-this.width/2,0)},Regulus.InfiniteBar.prototype.pointAtPosSide=function(t){var e=Regulus.Vector.fromDirection(this.rotation);return t.sub(this.position).rawProject(e)<=this.width/2},Regulus.InfiniteBar.prototype.pointAtNegSide=function(t){var e=Regulus.Vector.fromDirection(this.rotation);return t.sub(this.position).rawProject(e)>=-this.width/2},Regulus.InfiniteBar.prototype.clone=function(){return new Regulus.InfiniteBar(this.width,this.rotation,this.position.clone())},Regulus.InfiniteBar.prototype.mass=function(){return 1/0},Regulus.InfiniteBar.prototype.inertia=function(){return 1/0},Regulus.InfiniteBar.prototype.type="InfiniteBar"}(),function(){Regulus.InfinitePlane=function(t,e){this.rotation=t||0,this.position=new Regulus.Vector(e)},Regulus.InfinitePlane.prototype.area=function(){return 1/0},Regulus.InfinitePlane.prototype.circumference=function(){return 1/0},Regulus.InfinitePlane.prototype.pointInside=function(t){var e=Regulus.Vector.fromDirection(this.rotation);return t.sub(this.position).rawProject(e)<=0},Regulus.InfinitePlane.prototype.clone=function(){return new Regulus.InfinitePlane(this.rotation,this.position.clone())},Regulus.InfinitePlane.prototype.mass=function(){return 1/0},Regulus.InfinitePlane.prototype.inertia=function(){return 1/0},Regulus.InfinitePlane.prototype.type="InfinitePlane"}(),function(){function t(t,e){var i=1/0;return t.clone().forEach(function(t){var o=Regulus.DistanceToLine(e,this,t);o<i&&(i=o)}),i}function e(e,i){for(var o=e.x,s=e.y,n=i.vertices,r=!1,a=0,u=n.length-1;a<n.length;u=a++){var l=n[a].x,h=n[a].y,p=n[u].x,c=n[u].y;h>s!=c>s&&o<(p-l)*(s-h)/(c-h)+l&&(r=!r)}return r||t(i,e)<1e-5}function i(t,e,i){var o=0;return t.forEach(function(t){var s=Regulus.IntersectionPoint(this,t,e,i);s.between1&&s.between2&&o++}),o}function o(t){t.removeDoubles();for(var o=t.clone(),s=t.getComplexAngles(),n=0;n<s.length;n++){var r=s[n],a=1/0,u=null;if(o.forEach(function(o,s,n,l,h){if(n!==r.index&&l!==r.index&&h!==r.index){var p=r.vertex.dist(this);p<a&&i(t,r.vertex,this)<1&&e(this.add(r.vertex).div(2),t)&&(a=p,u={vertex:this,index:n})}}),u){var l=r.index,h=u.index;if(l>h){var p=l;l=h,h=p}var c=[],g=[];return o.forEach(function(t,e,i){i<l?c.push(this):i===l||i===h?(c.push(this),g.push(this)):i>l&&i<h?g.push(this):c.push(this)}),[new Regulus.Polygon(c),new Regulus.Polygon(g)]}}}function s(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];if(s.isConcave()){var n=o(s);e.push(n[0]),e.push(n[1])}else e.push(s)}return e}function n(t){for(var e=0;e<t.length;e++)if(t[e].isConcave())return!1;return!0}Regulus.DecompositePolygon=function(t,e){for(var i=Regulus.SimplifyPolygon(t,e);!n(i);)i=s(i);return i}}(),function(){function t(t){var e=t.clone(),i=t.getSelfIntersections()[0],o=[],s=[],n=i.index1,r=i.index2,a=i.point;if(r<n){var u=r;r=n,n=u}e.forEach(function(t,e,i){i<n&&o.push(this),i===n&&(o.push(this),o.push(a),s.push(a)),i>n&&i<r&&s.push(this),i===r&&(s.push(this),o.push(a),s.push(a)),i>r&&o.push(this)});var l=new Regulus.Vertices(o),h=new Regulus.Vertices(s),p=new Regulus.Polygon(l),c=new Regulus.Polygon(h);return p.removeDoubles(),c.removeDoubles(),[p,c]}function e(e){for(var i=[],o=0;o<e.length;o++){var s=e[o];if(s.isComplex()){var n=t(s);i.push(n[0]),i.push(n[1])}else i.push(s)}return i}function i(t){for(var e=0;e<t.length;e++)if(t[e].isComplex())return!1;return!0}Regulus.SimplifyPolygon=function(t){for(var o=[t];!i(o);)o=e(o);return o}}(),function(){Regulus.Renderer=function(t){var e=t.getContext("2d");this.fill="red",this.border="",this.borderWidth=2,this.zoom=1,this.translate=new Regulus.Vector(-t.width/2,-t.height/2),this.font="15px Helvetica",this.worldToCanvas=function(t){return t.sub(this.translate).mul(this.zoom)},this.canvasToWorld=function(t){return t.div(this.zoom).add(this.translate)},this.wipe=function(){e.clearRect(0,0,t.width,t.height)},this.drawPoint=function(t,i){t=this.worldToCanvas(t);var o=(i=i||4)/2;e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.closePath(),e.fillStyle=this.fill,e.fill()},this.drawSquarePoint=function(t,i){t=this.worldToCanvas(t);var o=(i=i||4)/2,s=t.sub(o);e.fillStyle=this.fill,e.fillRect(s.x,s.y,i,i)},this.drawCrossPoint=function(t,i,o){t=this.worldToCanvas(t);var s=(i=i||8)/2,n=t.sub(s,0),r=t.add(s,0),a=t.sub(0,s),u=t.add(0,s);e.strokeStyle=this.fill,e.lineWidth=o||2,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.moveTo(a.x,a.y),e.lineTo(u.x,u.y),e.stroke()},this.drawXPoint=function(t,i,o){t=this.worldToCanvas(t);var s=(i=i||6)/2*Math.sin(Math.PI/4),n=t.sub(s,s),r=t.add(s,s),a=t.subadd(s,s),u=t.addsub(s,s);e.strokeStyle=this.fill,e.lineWidth=o||2,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.moveTo(a.x,a.y),e.lineTo(u.x,u.y),e.stroke()},this.drawDiamondPoint=function(t,i){t=this.worldToCanvas(t);var o=(i=i||6)/2,s=t.sub(o,0),n=t.add(o,0),r=t.sub(0,o),a=t.add(0,o);e.fillStyle=this.fill,e.lineWidth=2,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(r.x,r.y),e.lineTo(n.x,n.y),e.lineTo(a.x,a.y),e.fill()},this.drawCircPoint=function(t,i,o){t=this.worldToCanvas(t),i=i||6;var s=(i-=o=o||2)/2;e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.closePath(),e.strokeStyle=this.fill,e.lineWidth=o,e.stroke()},this.drawPointHighlight=function(t,i){t=this.worldToCanvas(t);var o=(i=i||10)/2;e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.closePath(),e.fillStyle=this.fill,e.globalAlpha=.3,e.fill(),e.globalAlpha=1},this.drawVector=function(t,i,o,s,n){n=n||1,o=o||16,s=s||8,t.mul(this.zoom).mul(n),i=this.worldToCanvas(i),e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(i.x,i.y);var r=i.add(t);e.lineTo(r.x,r.y),e.stroke();var a=t.perp().norm().mul(o/2),u=a.neg(),l=t.mag()-s,h=t.norm().mul(l),p=h.add(a).add(i),c=h.add(u).add(i);e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(r.x,r.y),e.lineTo(c.x,c.y),e.stroke()},this.drawLineVector=function(t,i,o){o=o||1,t.mul(this.zoom).mul(o),i=this.worldToCanvas(i),e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(i.x,i.y);var s=i.add(t);e.lineTo(s.x,s.y),e.stroke()},this.drawNormal=function(t,e,i,o,s){i=i||20,this.drawVector(t.norm(),e,o,s,i)},this.drawLineNormal=function(t,e,i){i=i||20,this.drawLineVector(t.norm(),e,i)},this.drawAngleIndicators=!0,this.drawCircle=function(t){var i=this.worldToCanvas(t.position);e.beginPath(),e.arc(i.x,i.y,t.radius*this.zoom,t.rotation,2*Math.PI+t.rotation),this.drawAngleIndicators&&e.lineTo(i.x,i.y),e.fillStyle=this.fill,e.strokeStyle=this.border,e.lineWidth=this.borderWidth,e.fill(),e.stroke()},this.drawPolygon=function(t){e.beginPath();var i=t.clone(),o=this,s=!0;i.globalizeToRotation(t.rotation),i.globalizeToPoint(t.position),i.forEach(function(){var t=o.worldToCanvas(this);s?(e.moveTo(t.x,t.y),s=!1):e.lineTo(t.x,t.y)}),e.closePath(),e.fillStyle=this.fill,e.strokeStyle=this.border,e.lineWidth=this.borderWidth,e.fill(),e.stroke()},this.drawPlane=function(t){e.strokeStyle=this.border,e.fillStyle=this.fill,e.lineWidth=this.borderWidth;var i=Regulus.Vector.fromDirection(t.rotation).perp(),o=t.position,s=o.add(i),n=this.canvasToWorld(new Regulus.Vector(0,0)),r=this.canvasToWorld(new Regulus.Vector(e.canvas.width,e.canvas.height)),a=new Regulus.Vector(r.x,n.y),u=new Regulus.Vector(n.x,r.y),l=Regulus.IntersectionPoint(n,a,o,s),h=Regulus.IntersectionPoint(a,r,o,s),p=Regulus.IntersectionPoint(r,u,o,s),c=Regulus.IntersectionPoint(u,n,o,s),g=l.pt,d=h.pt,y=p.pt,f=c.pt,v=[];l.seg1&&v.push(g),h.seg1&&v.push(d),p.seg1&&v.push(y),c.seg1&&v.push(f);var b=[];if(t.pointInside(n)&&b.push(this.worldToCanvas(n)),v[0]!==g&&v[1]!==g||b.push(this.worldToCanvas(g)),t.pointInside(a)&&b.push(this.worldToCanvas(a)),v[0]!==d&&v[1]!==d||b.push(this.worldToCanvas(d)),t.pointInside(r)&&b.push(this.worldToCanvas(r)),v[0]!==y&&v[1]!==y||b.push(this.worldToCanvas(y)),t.pointInside(u)&&b.push(this.worldToCanvas(u)),v[0]!==f&&v[1]!==f||b.push(this.worldToCanvas(f)),b.length>0){e.beginPath(),e.moveTo(b[0].x,b[0].y);for(var m=1;m<b.length;m++)e.lineTo(b[m].x,b[m].y);e.closePath(),e.fill()}if(2===v.length){var R=this.worldToCanvas(v[0]),x=this.worldToCanvas(v[1]);e.beginPath(),e.moveTo(R.x,R.y),e.lineTo(x.x,x.y),e.stroke()}},this.drawBar=function(i){var o=Regulus.Vector.fromDirection(i.rotation),s=o.mul(i.width/2).add(i.position),n=o.neg().mul(i.width/2).add(i.position),r=o.perp(),a=s.add(r),u=n.add(r),l=this.canvasToWorld(new Regulus.Vector(0,0)),h=this.canvasToWorld(new Regulus.Vector(t.width,0)),p=this.canvasToWorld(new Regulus.Vector(t.width,t.height)),c=this.canvasToWorld(new Regulus.Vector(0,t.height)),g=[],d=[],y=[];i.pointInside(l)&&g.push(l);var f=Regulus.IntersectionPoint(s,a,l,h),v=Regulus.IntersectionPoint(n,u,l,h);v.seg2&&!f.seg2&&(g.push(v.pt),y.push(v.pt)),!v.seg2&&f.seg2&&(g.push(f.pt),d.push(f.pt)),v.seg2&&f.seg2&&(v.u2<f.u2?(g.push(v.pt),g.push(f.pt)):(g.push(f.pt),g.push(v.pt)),y.push(v.pt),d.push(f.pt)),i.pointInside(h)&&g.push(h);var b=Regulus.IntersectionPoint(s,a,h,p),m=Regulus.IntersectionPoint(n,u,h,p);m.seg2&&!b.seg2&&(g.push(m.pt),y.push(m.pt)),!m.seg2&&b.seg2&&(g.push(b.pt),d.push(b.pt)),m.seg2&&b.seg2&&(m.u2<b.u2?(g.push(m.pt),g.push(b.pt)):(g.push(b.pt),g.push(m.pt)),y.push(m.pt),d.push(b.pt)),i.pointInside(p)&&g.push(p);var R=Regulus.IntersectionPoint(s,a,p,c),x=Regulus.IntersectionPoint(n,u,p,c);x.seg2&&!R.seg2&&(g.push(x.pt),y.push(x.pt)),!x.seg2&&R.seg2&&(g.push(R.pt),d.push(R.pt)),x.seg2&&R.seg2&&(x.u2<R.u2?(g.push(x.pt),g.push(R.pt)):(g.push(R.pt),g.push(x.pt)),y.push(x.pt),d.push(R.pt)),i.pointInside(c)&&g.push(c);var w=Regulus.IntersectionPoint(s,a,c,l),P=Regulus.IntersectionPoint(n,u,c,l);P.seg2&&!w.seg2&&(g.push(P.pt),y.push(P.pt)),!P.seg2&&w.seg2&&(g.push(w.pt),d.push(w.pt)),P.seg2&&w.seg2&&(P.u2<w.u2?(g.push(P.pt),g.push(w.pt)):(g.push(w.pt),g.push(P.pt)),y.push(P.pt),d.push(w.pt));var C=!0;e.beginPath();for(var I=0;I<g.length;I++){var V=this.worldToCanvas(g[I]);C?(e.moveTo(V.x,V.y),C=!1):e.lineTo(V.x,V.y)}if(e.closePath(),e.fillStyle=this.fill,e.fill(),e.strokeStyle=this.border,e.lineWidth=this.borderWidth,2===y.length){var M=this.worldToCanvas(y[0]),T=this.worldToCanvas(y[1]);e.beginPath(),e.moveTo(M.x,M.y),e.lineTo(T.x,T.y),e.stroke()}if(2===d.length){var S=this.worldToCanvas(d[0]),A=this.worldToCanvas(d[1]);e.beginPath(),e.moveTo(S.x,S.y),e.lineTo(A.x,A.y),e.stroke()}},this.drawBox=function(t){var i=t.getMin(),o=t.getMax(),s=this.worldToCanvas(new Regulus.Vector(i)),n=this.worldToCanvas(new Regulus.Vector(o.x,i.y)),r=this.worldToCanvas(new Regulus.Vector(o)),a=this.worldToCanvas(new Regulus.Vector(i.x,o.y));e.globalAlpha=.3,e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(n.x,n.y),e.lineTo(r.x,r.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke(),e.globalAlpha=1},this.drawLabelToPoint=function(t,i,o,s,n){var r=this.worldToCanvas(i),a=new Regulus.Vector(o);e.fillStyle=this.fill,e.font=this.font,e.textAlign=(s||"left").toLowerCase(),e.textBaseline=(n||"top").toLowerCase(),e.fillText(t,r.x+a.x,r.y+a.y)},this.drawLabelToVector=function(t,e,i,o,s,n,r){r=void 0===r?.5:r;var a=e.mul(r).add(i);this.drawLabelToPoint(t,a,o,s,n)},this.drawLabelToBox=function(t,e,i,o,s,n){n=new Regulus.Vector(n);var r=e.size.mul(n),a=e.getMin().add(r);this.drawLabelToPoint(t,a,i,o,s)},this.drawLineSegment=function(t,i){var o=this.worldToCanvas(t),s=this.worldToCanvas(i);e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(s.x,s.y),e.stroke()},this.drawRay=function(i,o){var s=this.canvasToWorld(new Regulus.Vector(0,0)),n=this.canvasToWorld(new Regulus.Vector(t.width,0)),r=this.canvasToWorld(new Regulus.Vector(t.width,t.height)),a=this.canvasToWorld(new Regulus.Vector(0,t.height)),u=[],l=Regulus.IntersectionPoint(s,n,i,o);l.u2>0&&l.seg1&&u.push(l.pt);var h=Regulus.IntersectionPoint(n,r,i,o);h.u2>0&&h.between1&&u.push(h.pt);var p=Regulus.IntersectionPoint(a,r,i,o);p.u2>0&&p.seg1&&u.push(p.pt);var c=Regulus.IntersectionPoint(s,a,i,o);if(c.u2>0&&c.between1&&u.push(c.pt),!(u.length<1)){1===u.length&&u.unshift(i);var g=this.worldToCanvas(u[0]),d=this.worldToCanvas(u[1]);e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(d.x,d.y),e.stroke()}},this.drawInfiniteLine=function(i,o){var s=this.canvasToWorld(new Regulus.Vector(0,0)),n=this.canvasToWorld(new Regulus.Vector(t.width,0)),r=this.canvasToWorld(new Regulus.Vector(t.width,t.height)),a=this.canvasToWorld(new Regulus.Vector(0,t.height)),u=[],l=Regulus.IntersectionPoint(s,n,i,o);l.seg1&&u.push(l.pt);var h=Regulus.IntersectionPoint(n,r,i,o);h.between1&&u.push(h.pt);var p=Regulus.IntersectionPoint(a,r,i,o);p.seg1&&u.push(p.pt);var c=Regulus.IntersectionPoint(s,a,i,o);if(c.between1&&u.push(c.pt),!(u.length<2)){var g=this.worldToCanvas(u[0]),d=this.worldToCanvas(u[1]);e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(g.x,g.y),e.lineTo(d.x,d.y),e.stroke()}},this.drawDistanceIndicator=function(t,i,o,s){var n=this.worldToCanvas(t),r=this.worldToCanvas(i);o=void 0===o?10:o,s=s||0;var a=r.sub(n).perp().norm().mul(o/2),u=a.neg(),l=r.sub(n).perp().norm().mul(s),h=n.add(l),p=r.add(l),c=h.add(a),g=h.add(u),d=p.add(a),y=p.add(u);e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(g.x,g.y),e.stroke(),e.beginPath(),e.moveTo(d.x,d.y),e.lineTo(y.x,y.y),e.stroke(),e.beginPath(),e.moveTo(h.x,h.y),e.lineTo(p.x,p.y),e.stroke()},this.drawSpring=function(t,i,o,s,n,r,a){s=s||5;var u=Math.round(o*this.zoom/s);n=(n||5)/this.zoom,a=a||20,r=r||7;var l=i.sub(t).norm().perp();e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath();var h=this.worldToCanvas(t),p=this.worldToCanvas(i);e.moveTo(h.x,h.y),e.lineJoin="bevel";for(var c=i.dist(t),g=Math.pow(2/(c/o+1),2),d=1;d<u;d++){var y=d*s,f=d%2,v=t.add(i.sub(t).mul(y/o));1!==d&&d!==u-1&&(0===f?v.Add(l.mul(Regulus.Math.clamp(n*g,0,a))):v.Sub(l.mul(Regulus.Math.clamp(n*g,0,a)))),v=this.worldToCanvas(v),e.lineTo(v.x,v.y)}e.lineTo(p.x,p.y),e.stroke(),e.lineJoin="miter",this.drawPoint(t,r),this.drawPoint(i,r)},this.drawElastic=function(t,i,o,s,n){s=(s||7)/this.zoom,n=n||7;var r=i.sub(t).norm(),a=r.perp();e.strokeStyle=this.fill,e.lineWidth=this.borderWidth;var u=i.dist(t),l=u>o?Math.pow(2/(u/o+1),2):1,h=t.sub(r.mul(s*l)),p=i.add(r.mul(s*l)),c=this.worldToCanvas(h),g=this.worldToCanvas(h.add(a.mul(s*l))),d=this.worldToCanvas(h.sub(a.mul(s*l))),y=this.worldToCanvas(t.add(a.mul(s*l))),f=this.worldToCanvas(p),v=this.worldToCanvas(p.add(a.mul(s*l))),b=this.worldToCanvas(p.sub(a.mul(s*l))),m=this.worldToCanvas(i.sub(a.mul(s*l)));e.beginPath(),e.moveTo(y.x,y.y),e.arcTo(v.x,v.y,f.x,f.y,s*l),e.arcTo(b.x,b.y,m.x,m.y,s*l),e.arcTo(d.x,d.y,c.x,c.y,s*l),e.arcTo(g.x,g.y,y.x,y.y,s*l),e.stroke(),this.drawPoint(t,n),this.drawPoint(i,n)},this.drawSlider=function(t,i,o,s,n){s=s||7,n=n||.2,e.globalAlpha=n,this.drawLineSegment(t,i),e.globalAlpha=1,this.drawPoint(t,s),this.drawPoint(i,s),this.drawPoint(o,s)},this.drawDistance=function(t,e,i){i=i||7,this.drawLineSegment(t,e),this.drawPoint(t,i),this.drawPoint(e,i)},this.drawAxle=function(t,e){e=e||9,this.drawCircPoint(t,e)},this.drawGlue=function(t,e){e=e||9,this.drawXPoint(t,e)},this.drawPointFF=function(t,i,o,s,n){t=2*t*Math.abs(i);var r=Math.abs(t)%100;i<0&&(r=100-r),n=n||7;var a=.1*(1-r/100),u=this.worldToCanvas(o);this.drawPoint(o,n),s&&(e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.arc(u.x,u.y,s*this.zoom,0,2*Math.PI),e.closePath(),e.stroke()),e.fillStyle=this.fill,e.globalAlpha=a,e.beginPath(),e.arc(u.x,u.y,Regulus.Math.clamp(r,0,s||100)*this.zoom,0,2*Math.PI),e.closePath(),e.fill(),e.globalAlpha=1},this.drawVortexFF=function(t,i,o,s,n,r){t=t/10*i,n=n||7,r=r||.3;var a=this.worldToCanvas(o);this.drawPoint(o,n),s&&(e.strokeStyle=this.fill,e.lineWidth=this.borderWidth,e.beginPath(),e.arc(a.x,a.y,s*this.zoom,0,2*Math.PI),e.closePath(),e.stroke()),e.fillStyle=this.fill,e.globalAlpha=.2,e.beginPath(),e.arc(a.x,a.y,Regulus.Math.clamp(s*this.zoom,0,200),t,r+t),e.lineTo(a.x,a.y),e.closePath(),e.fill(),e.globalAlpha=1},this.drawLineFF=function(t,i,o,s,n){t=2*t*Math.abs(i);var r=Math.abs(t)%100;i<0&&(r=100-r);var a=.1*(1-r/100);if(this.drawLineSegment(o,s),n){var u=s.sub(o).norm().perp(),l=o.add(u.mul(n)),h=o.sub(u.mul(n)),p=s.add(u.mul(n)),c=s.sub(u.mul(n));this.drawLineSegment(l,p),this.drawLineSegment(h,c)}var g=this.borderWidth;this.borderWidth=Regulus.Math.clamp(r,0,n||100)*this.zoom*2,e.globalAlpha=a,this.drawLineSegment(o,s),e.globalAlpha=1,this.borderWidth=g},this.drawTeleporterFF=function(t,i,o,s){t/=4;var n=Math.abs(t)%20,r=.2*(1-n/20);this.drawPoint(o,s||7);var a=this.worldToCanvas(o);e.fillStyle=this.fill,e.globalAlpha=r,e.beginPath(),e.arc(a.x,a.y,n*this.zoom,0,2*Math.PI),e.closePath(),e.fill(),e.globalAlpha=1;var u=this.fill,l=this.border;this.border=this.fill,this.fill="transparent";var h=this.drawAngleIndicators;this.drawAngleIndicators=!1,"Polygon"===i.type&&this.drawPolygon(i),"Circle"===i.type&&this.drawCircle(i),"InfinitePlane"===i.type&&this.drawPlane(i),"InfiniteBar"===i.type&&this.drawBar(i),this.drawAngleIndicators=h,this.fill=u,this.border=l},this.drawManipulatorFF=function(t,i){var o=this.border;this.border="transparent",e.globalAlpha=.2,"Polygon"===i.type&&this.drawPolygon(i),"Circle"===i.type&&this.drawCircle(i),"InfinitePlane"===i.type&&this.drawPlane(i),"InfiniteBar"===i.type&&this.drawBar(i),e.globalAlpha=1,this.border=o}}}(),function(){Regulus.WorldRenderer=function(t){this.renderer=new Regulus.Renderer(t),this.angleIndicators=!1,this.boxes=!1,this.wireframes=!1,this.fpsdata=!1,this.centers=!1,this.velocities=0,this.collisions=!1,this.constraints=!0,this.forcefields=!0,this.sensors=!0,this.momentum=0,this.SATAxes=!1,this.render=function(t){var e=this.renderer;e.wipe();for(n=0;n<t.forcefields.length;n++){var i=t.forcefields[n];e.fill="#000","Point"===i.type&&e.drawPointFF(t.time,i.strength,i.pt,i.radius),"Line"===i.type&&e.drawLineFF(t.time,i.strength,i.pt1,i.pt2,i.radius),"Teleporter"===i.type&&e.drawTeleporterFF(t.time,i.shape,i.pt),"Move"===i.type&&e.drawManipulatorFF(t.time,i.shape),"Vortex"===i.type&&e.drawVortexFF(t.time,i.strength,i.pt,i.radius)}e.drawAngleIndicators=this.angleIndicators;for(n=0;n<t.bodies.length;n++){var o=t.bodies[n],s=o.getGlobalizedShape(!0);e.fill="rgba(255,255,255,0.2)",this.boxes&&s.getBox&&e.drawBox(s.getBox()),e.fill=this.wireframes?"transparent":o.color,e.border=this.wireframes?o.color:"transparent",e.borderWidth=2,"Polygon"===s.type&&e.drawPolygon(s),"Circle"===s.type&&e.drawCircle(s),"InfinitePlane"===s.type&&e.drawPlane(s),"InfiniteBar"===s.type&&e.drawBar(s)}for(var n=0;n<t.constraints.length;n++){var r=t.constraints[n];if(e.fill="#000","Axle"===r.type){a=r.getCorrectionData();e.drawAxle(a.gp1)}if("Distance"===r.type){a=r.getCorrectionData();e.drawDistance(a.gp1,a.gp2)}if("Slider"===r.type){a=r.getCorrectionData();e.drawSlider(r.pt2,r.pt3,a.gp)}if("Spring"===r.type){a=r.getCorrectionData();e.drawSpring(a.gp1,a.gp2,r.length)}if("Elastic"===r.type){var a=r.getCorrectionData();e.drawElastic(a.gp1,a.gp2,r.length)}}}}}(),function(){Regulus.CircleCircle=function(t,e){var i=t.position,o=e.position;if(!t.getBox().overlap(e.getBox()))return!1;var s=o.sub(i),n=s.mag(),r=t.radius+e.radius;if(n<=r){var a,u,l,h;return 0===n?(a=r,u=new Regulus.Vector(1,0),l=u.neg().Mul(t.radius-a),h=u.mul(e.radius-a),{normal:u,depth:a,p1:[h],p2:[l]}):(a=r-n,u=s.norm().Neg(),l=u.neg().Mul(t.radius-a),h=u.mul(e.radius-a),{normal:u,depth:a,p1:[h],p2:[l]})}return!1}}(),function(){function t(t,e){var i=1/0,o=null,s=null;return t.forEach(function(t){var n=Regulus.DistToLineInfo(e,this,t);n.distance<i&&(i=n.distance,o=n.normal,s=n.closest)}),{norm:o,dist:i,pt:s}}function e(t,e){for(var i=t.x,o=t.y,s=e.vertices,n=!1,r=0,a=s.length-1;r<s.length;a=r++){var u=s[r].x,l=s[r].y,h=s[a].x,p=s[a].y;l>o!=p>o&&i<(h-u)*(o-l)/(p-l)+u&&(n=!n)}return n}Regulus.CirclePolygon=function(i,o){if(!i.getBox().overlap(o.getBox()))return!1;var s=i.position,n=t(o,s);if(e(s,o)){var r=n.dist+i.radius,a=n.norm.norm(),u=a.neg().Mul(i.radius);return{normal:a,depth:r,p1:[n.pt.sub(o.position)],p2:[u]}}if(n.dist<=i.radius){var l=i.radius-n.dist,h=n.norm.norm(),p=h.mul(i.radius),c=n.pt.sub(o.position);return h.Neg(),{normal:h,depth:l,p1:[c],p2:[p]}}return!1}}(),function(){Regulus.CirclePlane=function(t,e){var i=t.position,o=e.position,s=Regulus.Vector.fromDirection(e.rotation),n=i.sub(o),r=n.rawProject(s),a=s.perp();if(r>t.radius)return!1;var u=t.radius-r,l=s,h=n.project(a);return{normal:l,depth:u,p1:[h],p2:[h.add(o).Add(l.mul(-u)).Sub(i)]}}}(),function(){Regulus.CircleBar=function(t,e){var i=t.position,o=e.position,s=Regulus.Vector.fromDirection(e.rotation),n=i.sub(o),r=n.rawProject(s),a=s.perp();if(Math.abs(r)>t.radius+e.width/2)return!1;if(r>=0)return{normal:l=s,depth:u=t.radius-r+e.width/2,p1:[h=n.project(a).Add(s.mul(e.width/2))],p2:[p=h.add(o).Add(l.mul(-u)).Sub(i)]};var u=t.radius+r+e.width/2,l=s.neg(),h=n.project(a).Add(s.mul(-e.width/2)),p=h.add(o).Add(l.mul(-u)).Sub(i);return{normal:l,depth:u,p1:[h],p2:[p]}}}(),function(){Regulus.PolygonBar=function(t,e){var i=e.position,o=t,s=Regulus.Vector.fromDirection(e.rotation),n=1/0,r=-1/0;o.forEach(function(){var t=this.sub(i).rawProject(s);t<n&&(n=t),t>r&&(r=t)});var a=-e.width/2,u=e.width/2;if(n>u||r<a)return!1;var l=s,h=!1;Math.abs(n-u)>Math.abs(r-a)&&(l.Neg(),h=!0);var p=Math.min(Math.abs(n-u),Math.abs(a-r)),c=t.getBestEdge(l.neg()),g=c.vtx1,d=c.vtx2;e.pointAtPosSide(g)||h?!e.pointAtNegSide(g)&&h&&(g=null):g=null,e.pointAtPosSide(d)||h?!e.pointAtNegSide(d)&&h&&(d=null):d=null,g||(g=d,d=null);var y=l.mul(e.width/2).Add(i),f=l.perp(),v=g.sub(y).Project(f).Add(y),b=d?d.sub(y).Project(f).Add(y):null;return g.Sub(t.position),d&&d.Sub(t.position),v.Sub(e.position),d&&b.Sub(e.position),d?{normal:l,depth:p,p1:[v,b],p2:[g,d]}:{normal:l,depth:p,p1:[v],p2:[g]}}}(),function(){Regulus.PolygonPlane=function(t,e){var i=e.position,o=t,s=Regulus.Vector.fromDirection(e.rotation),n=s.perp(),r=-1/0,a=-1/0,u=null,l=null,h=null,p=null,c=!1;return o.forEach(function(){var e=this.sub(i),o=e.rawProject(s);o<=0&&-o>r&&(r=-o,u=this.sub(t.position),h=e.project(n),c=!0)}),o.forEach(function(){var e=this.sub(i),o=e.rawProject(s);o<=0&&-o>a&&-o<r&&(a=-o,l=this.sub(t.position),p=e.project(n),c=!0)}),!!c&&(l?{normal:s,depth:r,p1:[h,p],p2:[u,l]}:{normal:s,depth:r,p1:[h],p2:[u]})}}(),function(){Regulus.PolygonPolygon=function(t,e){if(!t.getBox().overlap(e.getBox()))return!1;var i,o=t,s=e,n=t.getSATAxes(),r=e.getSATAxes(),a=!0,u=null,l=1/0;for(i=0;i<n.length;i++){var h=n[i],p=1/0,c=-1/0;o.forEach(function(){var t=this.rawProject(h);t>c&&(c=t),t<p&&(p=t)});var g=1/0,d=-1/0;if(s.forEach(function(){var t=this.rawProject(h);t>d&&(d=t),t<g&&(g=t)}),!(p<=d&&c>=g)){a=!1;break}var y=h.clone(),f=Math.min(Math.abs(p-d),Math.abs(g-c));Math.abs(p-d)<Math.abs(c-g)&&y.Neg(),(f<l||!a)&&(l=f,u=y,a=!0)}if(!a)return!1;for(i=0;i<r.length;i++){var h=r[i],p=1/0,c=-1/0;o.forEach(function(){var t=this.rawProject(h);t>c&&(c=t),t<p&&(p=t)});var g=1/0,d=-1/0;if(s.forEach(function(){var t=this.rawProject(h);t>d&&(d=t),t<g&&(g=t)}),!(p<=d&&c>=g)){a=!1;break}var y=h.clone(),f=Math.min(Math.abs(p-d),Math.abs(g-c));Math.abs(p-d)<Math.abs(c-g)&&y.Neg(),(f<l||!a)&&(l=f,u=y,a=!0)}if(!a)return!1;if(!a)return!1;var v,b,m=t.getBestEdge(u),R=e.getBestEdge(u.neg()),x=m.edge,w=R.edge,P=!1;Math.abs(x.dot(u))<=Math.abs(w.dot(u))?(v=m,b=R):(v=R,b=m,P=!0);var C=b.vtx1,I=b.vtx2,V=2,M=Regulus.IntersectionPoint(v.vtx1,v.vtx1.add(u),C,I);if(M.u2>=0&&M.u2<=1){var T=v.vtx2.sub(v.vtx1).Norm(),S=C.sub(v.vtx1),A=I.sub(v.vtx1),B=S.rawProject(T),W=A.rawProject(T);B<=0?C=M.pt:W<=0&&(I=M.pt)}var D=Regulus.IntersectionPoint(v.vtx2,v.vtx2.add(u),C,I);if(D.seg2){var F=v.vtx1.sub(v.vtx2).Norm(),k=C.sub(v.vtx2),E=I.sub(v.vtx2),z=k.rawProject(F),L=E.rawProject(F);z<=0?C=D.pt:L<=0&&(I=D.pt)}if(Regulus.IntersectionPoint(v.vtx1,v.vtx2,C,I).seg2){var j;j=P?u:u.neg();var N=C.sub(v.vtx1),q=I.sub(v.vtx1),G=N.rawProject(j),O=q.rawProject(j);G<0?(C=I,I=null,V=1):O<0&&(I=null,V=1)}var H=P?s:o,J=P?u.neg():u;if(!C)return!1;var X=null,K=null;return H.forEach(function(t){var e=Regulus.IntersectionPoint(C,C.add(J),this,t);e.u1>=0&&e.seg2&&(X=e.pt)}),V>1&&H.forEach(function(t){var e=Regulus.IntersectionPoint(I,I.add(J),this,t);e.u1>=0&&e.seg2&&(K=e.pt)}),V>1?{normal:u.neg(),depth:l,p2:P?[C.sub(t.position),I.sub(t.position)]:[X.sub(t.position),K.sub(t.position)],p1:P?[X.sub(e.position),K.sub(e.position)]:[C.sub(e.position),I.sub(e.position)]}:{normal:u.neg(),depth:l,p2:P?[C.sub(t.position)]:[X.sub(t.position)],p1:P?[X.sub(e.position)]:[C.sub(e.position)]}}}(),function(){Regulus.Body=function(t,e){e=e||{},this.shape=t,this.position=new Regulus.Vector(e.position),this.rotation=e.rotation||0,this.velocity=new Regulus.Vector(e.velocity),this.angular=e.angular||0,this.mass="number"==typeof e.mass?e.mass:e.density?t.mass(e.density):t.mass(.001),this.inertia="number"==typeof e.inertia?e.inertia:e.density?t.inertia(e.density):t.inertia(.001),this.restitution=e.restitution||0,this.staticFriction="number"==typeof e.staticFriction?e.staticFriction:.1,this.dynamicFriction="number"==typeof e.dynamicFriction?e.dynamicFriction:.1,this.conveyor=e.conveyor||0,this.static="boolean"==typeof e.static&&e.static,this.rotationStatic="boolean"==typeof e.rotationStatic&&e.rotationStatic,this.color="string"==typeof e.color?e.color:this.static?Regulus.Colormap.static:Regulus.Colormap[Math.floor(Math.random()*Regulus.Colormap.length)],this.positionVel=new Regulus.Vector,this.collisionLayers=Array.isArray(e.collisionLayers)?e.collisionLayers:[0]},Regulus.Body.prototype.getVelo=function(t,e){return this.velocity.add(this.positionVel).Add(t.mul(this.conveyor)).Sub(Regulus.Math.scalarVec(-this.angular,e))},Regulus.Body.prototype.getGlobalizedShape=function(t){if("Polygon"!==this.shape.type||t){var e=this.shape.clone();return e.position.Add(this.position),e.rotation+=this.rotation,e}return(e=this.shape.globalized(this.shape.rotation+this.rotation,this.shape.position.add(this.position))).isClockwise()&&e.reverse(),e.position.Add(this.position),e.rotation+=this.rotation,e},Regulus.Body.prototype.getInvMass=function(){return this.static?0:1/this.mass},Regulus.Body.prototype.getInvInertia=function(){return this.static||this.rotationStatic?0:1/this.inertia},Regulus.Body.prototype.applyImpulse=function(t,e){this.static||this.velocity.Add(t.mul(this.getInvMass())),this.static||this.rotationStatic||(this.angular+=e.cross(t)*this.getInvInertia())}}(),function(){Regulus.World=function(){this.gravity=new Regulus.Vector(0,.1),this.air=0,this.bodies=[],this.constraints=[],this.forcefields=[],this.sensors=[],this.collisions=[],this.timeScale=.5,this.iterations=6,this.time=0,this.air=.001,this.wind=new Regulus.Vector(0,0),this.static=!0,this.velocity=new Regulus.Vector,this.angular=0,this.position=new Regulus.Vector,this.rotation=0,this.positionVel=new Regulus.Vector},Regulus.World.prototype.getVelo=function(){return new Regulus.Vector},Regulus.World.prototype.getInvMass=function(){return 0},Regulus.World.prototype.getInvInertia=function(){return 0},Regulus.World.prototype.applyImpulse=function(){},Regulus.World.prototype.physics=function(t){this.static=!0,this.velocity.set(),this.position.set(),this.positionVel.set(),this.angular=0,this.rotation=0,this.time+=this.timeScale,this.collisions=[];for(var e=this.timeScale/this.iterations,i=0;i<this.iterations;i++){for(h=0;h<this.bodies.length;h++){for(var o=this.bodies[h],s={gravity:this.gravity.clone(),air:this.air,wind:this.wind.clone()},n=0;n<this.forcefields.length;n++)this.forcefields[n].applyOnBody(o,e,s);o.static||o.velocity.Add(s.gravity.mul(e)),o.static||o.velocity.Add(o.velocity.sub(s.wind).neg().mul(s.air*o.getInvMass())),o.static||(o.angular-=o.angular*s.air);for(n=h+1;n<this.bodies.length;n++){var r=this.bodies[n];if(this.bodiesCanCollide(o,r)){var a=new Regulus.Collision(o,r);a.collide&&this.collisions.push(a)}}}for(h=0;h<this.collisions.length;h++){var u=this.collisions[h];u.solve(t.renderer),u.correction()}for(h=0;h<this.constraints.length;h++){var l=this.constraints[h];l.solve(),l.correction()}for(var h=0;h<this.bodies.length;h++)(o=this.bodies[h]).static||o.position.Add(o.velocity.mul(e)),o.rotationStatic||o.static||(o.rotation+=o.angular*e),o.static||o.position.Add(o.positionVel),o.positionVel.set(0)}},Regulus.World.prototype.bodiesCanCollide=function(t,e){if(t.collisionLayers.length<1)return!1;if(e.collisionLayers.length<1)return!1;for(var i=!1,o=0;o<t.collisionLayers.length;o++)for(var s=0;s<e.collisionLayers.length;s++)t.collisionLayers[o]===e.collisionLayers[s]&&(i=!0);if(!i)return!1;var n=this.findConstraintWithBodies(t,e);if(n){if("Disable"===n.type&&n.enabled)return!1;if(n.disableCollision)return!1}return!0},Regulus.World.prototype.findConstraintWithBodies=function(t,e){for(var i=0;i<this.constraints.length;i++){var o=this.constraints[i];if("Slider"!==o.type)if("Disable"!==o.type){if(o.body1===t&&o.body2===e||o.body2===t&&o.body1===e)return o}else for(var s,n,r=0;r<o.bodies.length;r++){var a=o.bodies[r];if(a===t&&(s=!0),a===e&&(n=!0),s&&n)return o}}return null}}(),function(){Regulus.Collision=function(t,e){this.collide=!1,this.normal=null,this.depth=null,this.body1=t,this.body2=e,this.collisions=0,this.points1=[],this.points2=[];var i=t.getGlobalizedShape(),o=e.getGlobalizedShape(),s=!0;i.getBox&&o.getBox&&(i.getBox().overlap(o.getBox())||(s=!1)),t.static&&e.static&&(s=!1);var n=!1,r=!1;s&&("Circle"===i.type&&"Circle"===o.type&&(n=Regulus.CircleCircle(i,o)),"Circle"===i.type&&"Polygon"===o.type&&(n=Regulus.CirclePolygon(i,o)),"Polygon"===i.type&&"Circle"===o.type&&(n=Regulus.CirclePolygon(o,i),r=!0),"Polygon"===i.type&&"Polygon"===o.type&&(n=Regulus.PolygonPolygon(i,o)),"Circle"===i.type&&"InfinitePlane"===o.type&&(n=Regulus.CirclePlane(i,o)),"InfinitePlane"===i.type&&"Circle"===o.type&&(n=Regulus.CirclePlane(o,i),r=!0),"Polygon"===i.type&&"InfinitePlane"===o.type&&(n=Regulus.PolygonPlane(i,o)),"InfinitePlane"===i.type&&"Polygon"===o.type&&(n=Regulus.PolygonPlane(o,i),r=!0),"Circle"===i.type&&"InfiniteBar"===o.type&&(n=Regulus.CircleBar(i,o)),"InfiniteBar"===i.type&&"Circle"===o.type&&(n=Regulus.CircleBar(o,i),r=!0),"Polygon"===i.type&&"InfiniteBar"===o.type&&(n=Regulus.PolygonBar(i,o)),"InfiniteBar"===i.type&&"Polygon"===o.type&&(n=Regulus.PolygonBar(o,i),r=!0)),n&&(this.collide=!0,this.normal=r?n.normal:n.normal.neg(),this.depth=n.depth,this.collisions=n.p1.length,this.points1=r?n.p1:n.p2,this.points2=r?n.p2:n.p1)},Regulus.Collision.prototype.solve=function(t){if(this.collide)for(var e=this.body1,i=this.body2,o=this.normal,s=this.points1.length,n=0;n<s;n++){var r=this.points1[n],a=this.points2[n],u=i.getVelo(o.perp(),a).sub(e.getVelo(o.negperp(),r)),l=u.dot(o),h=r.cross(o),p=a.cross(o),c=e.getInvMass()+i.getInvMass()+h*h*e.getInvInertia()+p*p*i.getInvInertia();if(l>0)return;var g=-(1+Math.min(e.restitution,i.restitution))*l;g/=c,g/=s;var d=o.mul(g);e.applyImpulse(d.neg(),r),i.applyImpulse(d,a);var y=u.project(o.perp());y.Norm();var f=u.dot(y);f/=c,f/=s,f=Math.round(1e5*f)/1e5;var v,b=Regulus.Math.pythagoreanSolve(e.staticFriction,i.staticFriction);if(Math.abs(f)<g*b)v=y.mul(f);else{var m=Regulus.Math.pythagoreanSolve(e.dynamicFriction,i.dynamicFriction);v=y.mul(-g).Mul(m)}e.applyImpulse(v.neg(),r),i.applyImpulse(v,a)}},Regulus.Collision.prototype.correction=function(){if(this.collide){var t=this.body1,e=this.body2,i=this.normal,o=this.depth,s=i.mul(Math.max(o-0,0)/(t.getInvMass()+e.getInvMass())*.2);t.static?e.positionVel.Add(s.mul(e.getInvMass())):e.static?t.positionVel.Sub(s.mul(t.getInvMass())):(t.positionVel.Sub(s.mul(t.getInvMass())),e.positionVel.Add(s.mul(e.getInvMass())))}}}(),function(){Regulus.AxleConstraint=function(t,e,i,o,s){s=s||{},this.body1=t,this.body2=i,this.pt1=e,this.pt2=o,this.disableCollision="boolean"!=typeof s.disableCollision||s.disableCollision,this.enabled="boolean"!=typeof s.enabled||s.enabled},Regulus.AxleConstraint.prototype.getCorrectionData=function(){var t=this.pt1.rotate(this.body1.rotation),e=this.pt2.rotate(this.body2.rotation),i=t.add(this.body1.position),o=e.add(this.body2.position),s=o.sub(i);return{rp1:t,rp2:e,gp1:i,gp2:o,rel:s,depth:s.mag(),normal:s.neg().norm()}},Regulus.AxleConstraint.prototype.solve=function(){if(this.enabled){var t=this.getCorrectionData(),e=this.body1,i=this.body2,o=t.rp1,s=t.rp2,n=i.getVelo(t.normal.perp(),s).sub(e.getVelo(t.normal.perp(),o)).dot(t.normal);if(!(n>0)){var r=o.cross(t.normal),a=s.cross(t.normal),u=-n;u/=e.getInvMass()+i.getInvMass()+r*r*e.getInvInertia()+a*a*i.getInvInertia();var l=t.normal.mul(u);e.applyImpulse(l.neg(),o),i.applyImpulse(l,s)}}},Regulus.AxleConstraint.prototype.correction=function(){if(this.enabled){var t=this.getCorrectionData(),e=this.body1,i=this.body2,o=t.depth,s=t.normal.mul(Math.max(o-0,0)/(e.getInvMass()+i.getInvMass())*.2);e.static?i.positionVel.Add(s.mul(i.getInvMass())):i.static?e.positionVel.Sub(s.mul(e.getInvMass())):(e.positionVel.Sub(s.mul(e.getInvMass())),i.positionVel.Add(s.mul(i.getInvMass())))}},Regulus.AxleConstraint.prototype.type="Axle"}(),function(){Regulus.DisableConstraint=function(t,e){e=e||{},this.bodies=t,this.enabled="boolean"!=typeof e.enabled||e.enabled},Regulus.DisableConstraint.prototype.getCorrectionData=function(){},Regulus.DisableConstraint.prototype.solve=function(){},Regulus.DisableConstraint.prototype.correction=function(){},Regulus.DisableConstraint.prototype.type="Disable"}(),function(){Regulus.DistanceConstraint=function(t,e,i,o,s){s=s||{},this.body1=t,this.body2=i,this.pt1=e,this.pt2=o,this.mindistance="number"==typeof s.mindistance?s.mindistance:100,this.maxdistance="number"==typeof s.maxdistance?s.maxdistance:100,this.disableCollision="boolean"!=typeof s.disableCollision||s.disableCollision,this.enabled="boolean"!=typeof s.enabled||s.enabled},Regulus.DistanceConstraint.prototype.getCorrectionData=function(){var t=this.pt1.rotate(this.body1.rotation),e=this.pt2.rotate(this.body2.rotation),i=t.add(this.body1.position),o=e.add(this.body2.position),s=o.sub(i),n=!1,r=s.mag(),a=0,u=s.neg().norm();return r>this.maxdistance&&(a=r-this.maxdistance,n=!0),r<this.mindistance&&(a=this.mindistance-r,n=!0,u.Neg()),{rp1:t,rp2:e,gp1:i,gp2:o,rel:s,mag:r,depth:a,normal:u,solve:n}},Regulus.DistanceConstraint.prototype.solve=function(){if(this.enabled){var t=this.getCorrectionData();if(t.solve){var e=this.body1,i=this.body2,o=t.rp1,s=t.rp2,n=i.getVelo(t.normal.perp(),s).sub(e.getVelo(t.normal.perp(),o)).dot(t.normal);if(!(n>0)){var r=o.cross(t.normal),a=s.cross(t.normal),u=-n;u/=e.getInvMass()+i.getInvMass()+r*r*e.getInvInertia()+a*a*i.getInvInertia();var l=t.normal.mul(u);e.applyImpulse(l.neg(),o),i.applyImpulse(l,s)}}}},Regulus.DistanceConstraint.prototype.correction=function(){if(this.enabled){var t=this.getCorrectionData();if(t.solve){var e=this.body1,i=this.body2,o=t.depth,s=t.normal.mul(Math.max(o-0,0)/(e.getInvMass()+i.getInvMass())*.2);e.static?i.positionVel.Add(s.mul(i.getInvMass())):i.static?e.positionVel.Sub(s.mul(e.getInvMass())):(e.positionVel.Sub(s.mul(e.getInvMass())),i.positionVel.Add(s.mul(i.getInvMass())))}}},Regulus.DistanceConstraint.prototype.type="Distance"}(),function(){Regulus.ElasticConstraint=function(t,e,i,o,s){s=s||{},this.body1=t,this.body2=i,this.pt1=e,this.pt2=o,this.length="number"==typeof s.length?s.length:100,this.springConstant="number"==typeof s.springConstant?s.springConstant:.005,this.damping="number"==typeof s.damping?s.damping:.001,this.disableCollision="boolean"!=typeof s.disableCollision||s.disableCollision,this.enabled="boolean"!=typeof s.enabled||s.enabled},Regulus.ElasticConstraint.prototype.getCorrectionData=function(){var t=this.pt1.rotate(this.body1.rotation),e=this.pt2.rotate(this.body2.rotation),i=t.add(this.body1.position),o=e.add(this.body2.position),s=o.sub(i),n=s.mag(),r=!0,a=0,u=s.neg().norm();return n<this.length?r=!1:a=n-this.length,{rp1:t,rp2:e,gp1:i,gp2:o,rel:s,mag:n,depth:a,normal:u,solve:r}},Regulus.ElasticConstraint.prototype.solve=function(){if(this.enabled){var t=this.getCorrectionData();if(t.solve){var e=this.body1,i=this.body2,o=t.rp1,s=t.rp2,n=i.getVelo(t.normal.perp(),s).sub(e.getVelo(t.normal.perp(),o)).dot(t.normal),r=o.cross(t.normal),a=s.cross(t.normal),u=(e.getInvMass(),i.getInvMass(),e.getInvInertia(),i.getInvInertia(),this.springConstant*t.depth-this.damping*n),l=t.normal.mul(u);e.applyImpulse(l.neg(),o),i.applyImpulse(l,s)}}},Regulus.ElasticConstraint.prototype.correction=function(){},Regulus.ElasticConstraint.prototype.type="Elastic"}(),function(){Regulus.SliderConstraint=function(t,e,i,o,s){s=s||{},this.body=t,this.pt1=e,this.pt2=i,this.pt3=o,this.enabled="boolean"!=typeof s.enabled||s.enabled},Regulus.SliderConstraint.prototype.getCorrectionData=function(){var t=this.pt1.rotate(this.body.rotation),e=t.add(this.body.position),i=Regulus.DistToLineInfo(e,this.pt2,this.pt3);return{rp:t,gp:e,depth:i.distance,normal:i.normal.neg()}},Regulus.SliderConstraint.prototype.solve=function(){if(this.enabled){var t=this.getCorrectionData(),e=this.body,i=t.rp,o=e.getVelo(t.normal.neg().perp(),i).dot(t.normal.neg());if(!(o>0)){var s=i.cross(t.normal),n=-o;n/=e.getInvMass()+s*s*e.getInvInertia();var r=t.normal.mul(n);e.applyImpulse(r.neg(),i)}}},Regulus.SliderConstraint.prototype.correction=function(){if(this.enabled){var t=this.getCorrectionData(),e=this.body,i=t.depth,o=t.normal;o.mul(Math.max(i-0,0)/e.getInvMass()*.2);e.positionVel.Sub(o.mul(i))}},Regulus.SliderConstraint.prototype.type="Slider"}(),function(){Regulus.SpringConstraint=function(t,e,i,o,s){s=s||{},this.body1=t,this.body2=i,this.pt1=e,this.pt2=o,this.length="number"==typeof s.length?s.length:100,this.springConstant="number"==typeof s.springConstant?s.springConstant:.005,this.damping="number"==typeof s.damping?s.damping:.001,this.disableCollision="boolean"!=typeof s.disableCollision||s.disableCollision,this.enabled="boolean"!=typeof s.enabled||s.enabled},Regulus.SpringConstraint.prototype.getCorrectionData=function(){var t=this.pt1.rotate(this.body1.rotation),e=this.pt2.rotate(this.body2.rotation),i=t.add(this.body1.position),o=e.add(this.body2.position),s=o.sub(i),n=s.mag(),r=0,a=s.neg().norm();return n<this.length?(r=this.length-n,a.Neg()):r=n-this.length,{rp1:t,rp2:e,gp1:i,gp2:o,rel:s,mag:n,depth:r,normal:a}},Regulus.SpringConstraint.prototype.solve=function(){if(this.enabled){var t=this.getCorrectionData(),e=this.body1,i=this.body2,o=t.rp1,s=t.rp2,n=i.getVelo(t.normal.perp(),s).sub(e.getVelo(t.normal.perp(),o)).dot(t.normal),r=o.cross(t.normal),a=s.cross(t.normal),u=(e.getInvMass(),i.getInvMass(),e.getInvInertia(),i.getInvInertia(),this.springConstant*t.depth-this.damping*n),l=t.normal.mul(u);e.applyImpulse(l.neg(),o),i.applyImpulse(l,s)}},Regulus.SpringConstraint.prototype.correction=function(){},Regulus.SpringConstraint.prototype.type="Spring"}(),function(){Regulus.LineFF=function(t,e,i){i=i||{},this.pt1=t,this.pt2=e,this.strength="number"==typeof i.strength?i.strength:1,this.radius="number"==typeof i.radius?i.radius:100},Regulus.LineFF.prototype.applyOnBody=function(t,e){var i=Regulus.DistToLineInfo(t.position,this.pt1,this.pt2),o=i.distance,s=i.normal;if(i.onEdge&&o<=this.radius){var n=s.neg().mul(this.strength);t.static||t.velocity.Add(n.mul(e))}},Regulus.LineFF.prototype.type="Line"}(),function(){Regulus.MoveFF=function(t,e){e=e||{},this.shape=t,this.move=new Regulus.Vector(e.move),this.wind=new Regulus.Vector(e.wind),this.disableGravity="boolean"==typeof e.disableGravity&&e.disableGravity,this.disableWind="boolean"==typeof e.disableWind&&e.disableWind,this.air="number"==typeof e.air?e.air:-1},Regulus.MoveFF.prototype.applyOnBody=function(t,e,i){if(this.shape.pointInside(t.position)){if(t.static)return;this.disableWind&&i.wind.set(0),i.wind.Sub(this.wind),this.air>-1&&(i.air=this.air),this.disableGravity&&i.gravity.set(0),t.velocity.Add(this.move.mul(e))}},Regulus.MoveFF.prototype.type="Move"}(),function(){Regulus.PointFF=function(t,e){e=e||{},this.pt=t,this.strength="number"==typeof e.strength?e.strength:1,this.radius="number"==typeof e.radius?e.radius:100},Regulus.PointFF.prototype.applyOnBody=function(t,e){var i=this.pt.sub(t.position),o=i.mag(),s=i.norm();if(o<=this.radius){var n=s.neg().mul(this.strength);t.static||t.velocity.Add(n.mul(e))}},Regulus.PointFF.prototype.type="Point"}(),function(){Regulus.TeleporterFF=function(t,e,i){i=i||{},this.pt=t,this.shape=e},Regulus.TeleporterFF.prototype.applyOnBody=function(t){this.shape.pointInside(t.position)&&(t.static||t.position.set(this.pt))},Regulus.TeleporterFF.prototype.type="Teleporter"}(),function(){Regulus.VortexFF=function(t,e){e=e||{},this.pt=t,this.strength="number"==typeof e.strength?e.strength:1,this.radius="number"==typeof e.radius?e.radius:100},Regulus.VortexFF.prototype.applyOnBody=function(t,e){var i=this.pt.sub(t.position),o=i.mag(),s=i.norm().perp();if(o<=this.radius){var n=s.mul(this.strength);t.static||t.velocity.Add(n.mul(e))}},Regulus.VortexFF.prototype.type="Vortex"}();